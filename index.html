<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Identify Characteristics of Patients in the OMOP Common Data Model • PatientProfiles</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Identify Characteristics of Patients in the OMOP Common Data Model">
<meta name="description" content="Identify the characteristics of patients in data mapped to the Observational Medical Outcomes Partnership (OMOP) common data model.">
<meta property="og:description" content="Identify the characteristics of patients in data mapped to the Observational Medical Outcomes Partnership (OMOP) common data model.">
<meta property="og:image" content="https://darwin-eu.github.io/PatientProfiles/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">PatientProfiles</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.1.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>PatientProfiles</h6></li>
    <li><a class="dropdown-item" href="articles/demographics.html">Adding patient demographics</a></li>
    <li><a class="dropdown-item" href="articles/cohort-intersect.html">Adding cohort intersections</a></li>
    <li><a class="dropdown-item" href="articles/concept-intersect.html">Adding concept intersections</a></li>
    <li><a class="dropdown-item" href="articles/table-intersect.html">Adding table intersections</a></li>
    <li><a class="dropdown-item" href="articles/summarise.html">Summarise result</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/darwin-eu/PatientProfiles/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="patientprofiles-">PatientProfiles <a class="anchor" aria-label="anchor" href="#patientprofiles-"></a>
</h1>
</div>
<p><a href="https://CRAN.R-project.org/package=PatientProfiles" class="external-link"><img src="https://www.r-pkg.org/badges/version/PatientProfiles" alt="CRAN status"></a> <a href="https://app.codecov.io/github/darwin-eu/PatientProfiles?branch=main" class="external-link"><img src="https://codecov.io/github/darwin-eu/PatientProfiles/coverage.svg?branch=main" alt="codecov.io"></a> <a href="https://github.com/darwin-eu/PatientProfiles/actions" class="external-link"><img src="https://github.com/darwin-eu/PatientProfiles/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle:stable"></a> <a href="https://cran.r-project.org/package=PatientProfiles" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/PatientProfiles" alt="metacran downloads"></a> <a href="https://cran.r-project.org/package=PatientProfiles" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/PatientProfiles" alt="metacran downloads"></a></p>
<div class="section level2">
<h2 id="package-overview">Package overview<a class="anchor" aria-label="anchor" href="#package-overview"></a>
</h2>
<p>PatientProfiles contains functions for adding characteristics to OMOP CDM tables containing patient level data (e.g. condition occurrence, drug exposure, and so on) and OMOP CDM cohort tables. The characteristics that can be added include an individual´s sex, age, and days of prior observation Time varying characteristics, such as age, can be estimated relative to any date in the corresponding table. In addition, PatientProfiles also provides functionality for identifying intersections between a cohort table and OMOP CDM tables containing patient level data or other cohort tables.</p>
</div>
<div class="section level2">
<h2 id="package-installation">Package installation<a class="anchor" aria-label="anchor" href="#package-installation"></a>
</h2>
<p>You can install the latest version of PatientProfiles like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"PatientProfiles"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"PatientProfiles"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To cite package 'PatientProfiles' in publications use:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Catala M, Guo Y, Du M, Lopez-Guell K, Burn E, Mercade-Besora N</span></span>
<span><span class="co">#&gt;   (????). _PatientProfiles: Identify Characteristics of Patients in the</span></span>
<span><span class="co">#&gt;   OMOP Common Data Model_. R package version 1.2.1,</span></span>
<span><span class="co">#&gt;   &lt;https://darwin-eu.github.io/PatientProfiles/&gt;.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   @Manual{,</span></span>
<span><span class="co">#&gt;     title = {PatientProfiles: Identify Characteristics of Patients in the OMOP Common Data Model},</span></span>
<span><span class="co">#&gt;     author = {Marti Catala and Yuchen Guo and Mike Du and Kim Lopez-Guell and Edward Burn and Nuria Mercade-Besora},</span></span>
<span><span class="co">#&gt;     note = {R package version 1.2.1},</span></span>
<span><span class="co">#&gt;     url = {https://darwin-eu.github.io/PatientProfiles/},</span></span>
<span><span class="co">#&gt;   }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-usage">Example usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h2>
<div class="section level3">
<h3 id="create-a-reference-to-data-in-the-omop-cdm-format">Create a reference to data in the OMOP CDM format<a class="anchor" aria-label="anchor" href="#create-a-reference-to-data-in-the-omop-cdm-format"></a>
</h3>
<p>The PatientProfiles package is designed to work with data in the OMOP CDM format, so our first step is to create a reference to the data using the CDMConnector package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/PatientProfiles/">PatientProfiles</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>Creating a connection to a Postgres database would for example look like:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span></span>
<span>  <span class="fu">RPostgres</span><span class="fu">::</span><span class="fu"><a href="https://rpostgres.r-dbi.org/reference/Postgres.html" class="external-link">Postgres</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dbname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_DBNAME"</span><span class="op">)</span>,</span>
<span>  host <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_HOST"</span><span class="op">)</span>,</span>
<span>  user <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_USER"</span><span class="op">)</span>,</span>
<span>  password <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_PASSWORD"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdm_from_con.html" class="external-link">cdm_from_con</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  cdm_schema <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_CDM_SCHEMA"</span><span class="op">)</span>,</span>
<span>  write_schema <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_RESULT_SCHEMA"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To see how you would create a reference to your database please consult the CDMConnector package <a href="https://darwin-eu.github.io/CDMConnector/articles/a04_DBI_connection_examples.html" class="external-link">documentation</a>. For this example though we’ll work with simulated data, and we’ll generate an example cdm reference like so:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mockPatientProfiles.html">mockPatientProfiles</a></span><span class="op">(</span>numberIndividuals <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-individuals-characteristics">Adding individuals´ characteristics<a class="anchor" aria-label="anchor" href="#adding-individuals-characteristics"></a>
</h3>
<div class="section level4">
<h4 id="adding-characteristics-to-patient-level-data">Adding characteristics to patient-level data<a class="anchor" aria-label="anchor" href="#adding-characteristics-to-patient-level-data"></a>
</h4>
<p>Say we wanted to get individuals´sex and age at condition start date for records in the condition occurrence table. We can use the <code>addAge</code> and <code>addSex</code> functions to do this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ person_id                 &lt;int&gt; 778, 530, 421, 858, 144, 579, 646, 185, 174,…</span></span>
<span><span class="co">#&gt; $ condition_start_date      &lt;date&gt; 1912-06-09, 1990-01-17, 1946-11-29, 1953-11…</span></span>
<span><span class="co">#&gt; $ condition_end_date        &lt;date&gt; 1922-03-03, 1991-11-16, 1949-05-22, 1965-10…</span></span>
<span><span class="co">#&gt; $ condition_occurrence_id   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</span></span>
<span><span class="co">#&gt; $ condition_concept_id      &lt;int&gt; 2, 5, 5, 5, 7, 7, 10, 4, 10, 5, 6, 7, 2, 4, …</span></span>
<span><span class="co">#&gt; $ condition_type_concept_id &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addAge.html">addAge</a></span><span class="op">(</span>indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addSex.html">addSex</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ person_id                 &lt;int&gt; 778, 530, 858, 144, 579, 185, 174, 426, 9, 5…</span></span>
<span><span class="co">#&gt; $ condition_start_date      &lt;date&gt; 1912-06-09, 1990-01-17, 1953-11-10, 1966-05…</span></span>
<span><span class="co">#&gt; $ condition_end_date        &lt;date&gt; 1922-03-03, 1991-11-16, 1965-10-24, 1966-07…</span></span>
<span><span class="co">#&gt; $ condition_occurrence_id   &lt;int&gt; 1, 2, 4, 5, 6, 8, 9, 10, 11, 13, 14, 15, 17,…</span></span>
<span><span class="co">#&gt; $ condition_concept_id      &lt;int&gt; 2, 5, 5, 7, 7, 4, 10, 5, 6, 2, 4, 1, 6, 5, 6…</span></span>
<span><span class="co">#&gt; $ condition_type_concept_id &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">#&gt; $ age                       &lt;int&gt; 5, 31, 22, 16, 50, 0, 16, 28, 20, 10, 34, 7,…</span></span>
<span><span class="co">#&gt; $ sex                       &lt;chr&gt; "Male", "Male", "Male", "Female", "Male", "M…</span></span></code></pre></div>
<p>We could, for example, then limit our data to only males aged between 18 and 65</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">65</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:   SQL [?? x 8]</span></span>
<span><span class="co">#&gt; # Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt;    person_id condition_start_date condition_end_date condition_occurrence_id</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;date&gt;               &lt;date&gt;                               &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1       530 1990-01-17           1991-11-16                               2</span></span>
<span><span class="co">#&gt;  2       858 1953-11-10           1965-10-24                               4</span></span>
<span><span class="co">#&gt;  3       579 1996-12-07           1998-01-13                               6</span></span>
<span><span class="co">#&gt;  4       426 1991-03-14           1997-04-27                              10</span></span>
<span><span class="co">#&gt;  5         9 1966-12-27           1969-06-02                              11</span></span>
<span><span class="co">#&gt;  6        32 2000-06-03           2008-07-17                              17</span></span>
<span><span class="co">#&gt;  7         9 1973-12-31           1987-05-25                              23</span></span>
<span><span class="co">#&gt;  8       649 2000-08-22           2008-02-22                              33</span></span>
<span><span class="co">#&gt;  9       284 1931-11-30           1939-01-08                              49</span></span>
<span><span class="co">#&gt; 10       707 1977-02-11           1978-10-10                              54</span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span>
<span><span class="co">#&gt; # ℹ 4 more variables: condition_concept_id &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   condition_type_concept_id &lt;int&gt;, age &lt;int&gt;, sex &lt;chr&gt;</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adding-characteristics-of-a-cohort">Adding characteristics of a cohort<a class="anchor" aria-label="anchor" href="#adding-characteristics-of-a-cohort"></a>
</h4>
<p>As with other tables in the OMOP CDM, we can work in a similar way with cohort tables. For example, say we have the below cohort table</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 1, 2, 1, 2, 3, 1, 3, 2, 3, 1, 2, 1, 2, 1, 2, 2…</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 93, 783, 571, 218, 462, 103, 15, 404, 602, 333, 1…</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1970-07-10, 1943-10-13, 1933-05-15, 1934-06-18, …</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1984-02-26, 1947-11-11, 1933-06-11, 1949-09-17, …</span></span></code></pre></div>
<p>We can add age, age groups, sex, and days of prior observation to a cohort like so</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addAge.html">addAge</a></span><span class="op">(</span></span>
<span>    indexDate <span class="op">=</span> <span class="st">"cohort_start_date"</span>,</span>
<span>    ageGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">65</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">66</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addSex.html">addSex</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addPriorObservation.html">addPriorObservation</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 1, 2, 2, 2, 1, 3, 2, 2, 3, 1, 1, 2, 1, 2, 2, 2, 3…</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 2, 4, 5, 7, 8, 9, 11, 13, 14, 15, 17, 18, 22, 24,…</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1931-10-24, 1975-04-04, 1978-03-13, 1914-07-03, …</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1953-08-30, 1987-07-31, 1988-01-13, 1925-06-15, …</span></span>
<span><span class="co">#&gt; $ age                  &lt;int&gt; 10, 0, 3, 0, 12, 5, 21, 14, 8, 16, 0, 10, 1, 0, 8…</span></span>
<span><span class="co">#&gt; $ age_group            &lt;chr&gt; "0 to 18", "0 to 18", "0 to 18", "0 to 18", "0 to…</span></span>
<span><span class="co">#&gt; $ sex                  &lt;chr&gt; "Male", "Male", "Female", "Female", "Male", "Male…</span></span>
<span><span class="co">#&gt; $ prior_observation    &lt;int&gt; 3948, 93, 1167, 183, 4705, 2100, 7942, 5238, 3203…</span></span></code></pre></div>
<p>We could use this information to subset the cohort. For example limiting to those with at least 365 days of prior observation available before their cohort start date like so</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">prior_observation</span> <span class="op">&gt;=</span> <span class="fl">365</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:   SQL [?? x 8]</span></span>
<span><span class="co">#&gt; # Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt;    cohort_definition_id subject_id cohort_start_date cohort_end_date   age</span></span>
<span><span class="co">#&gt;                   &lt;int&gt;      &lt;int&gt; &lt;date&gt;            &lt;date&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1                    1          2 1931-10-24        1953-08-30         10</span></span>
<span><span class="co">#&gt;  2                    2          5 1978-03-13        1988-01-13          3</span></span>
<span><span class="co">#&gt;  3                    1          8 1933-11-19        1935-05-11         12</span></span>
<span><span class="co">#&gt;  4                    3          9 1951-10-02        1966-05-19          5</span></span>
<span><span class="co">#&gt;  5                    2         11 1987-09-30        1991-02-25         21</span></span>
<span><span class="co">#&gt;  6                    2         13 1934-05-05        1937-09-21         14</span></span>
<span><span class="co">#&gt;  7                    3         14 1988-10-08        1990-12-31          8</span></span>
<span><span class="co">#&gt;  8                    1         15 1920-05-19        1924-07-11         16</span></span>
<span><span class="co">#&gt;  9                    2         18 1973-11-17        1978-07-31         10</span></span>
<span><span class="co">#&gt; 10                    1         22 1938-09-28        1956-07-31          1</span></span>
<span><span class="co">#&gt; # ℹ more rows</span></span>
<span><span class="co">#&gt; # ℹ 3 more variables: age_group &lt;chr&gt;, sex &lt;chr&gt;, prior_observation &lt;int&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="cohort-intersections">Cohort intersections<a class="anchor" aria-label="anchor" href="#cohort-intersections"></a>
</h3>
<div class="section level4">
<h4 id="detect-the-presence-of-another-cohort-in-a-certain-window">Detect the presence of another cohort in a certain window<a class="anchor" aria-label="anchor" href="#detect-the-presence-of-another-cohort-in-a-certain-window"></a>
</h4>
<p>We can use <code>addCohortIntersectFlag</code> to add a flag for the presence (or not) of a cohort in a certain window.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 3, 1, 2, 2, 3, 2, 2, 2, 1, 3</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 10, 4, 1, 5, 3, 7, 9, 6, 2, 8</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1974-02-03, 1918-10-07, 1967-07-21, 1951-05-19, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1974-12-26, 1920-03-27, 1967-12-09, 1953-09-30, 1…</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addCohortIntersectFlag.html">addCohortIntersectFlag</a></span><span class="op">(</span></span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 3, 2, 2, 2, 2, 1, 3, 2, 1, 3</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 10, 1, 5, 7, 9, 4, 3, 6, 2, 8</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1974-02-03, 1967-07-21, 1951-05-19, 1934-06-19, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1974-12-26, 1967-12-09, 1953-09-30, 1938-06-10, 1…</span></span>
<span><span class="co">#&gt; $ cohort_1_minf_to_m1  &lt;dbl&gt; 0, 1, 0, 0, 1, 0, 0, 0, 0, 0</span></span>
<span><span class="co">#&gt; $ cohort_2_minf_to_m1  &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0</span></span>
<span><span class="co">#&gt; $ cohort_3_minf_to_m1  &lt;dbl&gt; 0, 0, 1, 1, 0, 0, 0, 0, 0, 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="count-appearances-of-a-certain-cohort-in-a-certain-window">Count appearances of a certain cohort in a certain window<a class="anchor" aria-label="anchor" href="#count-appearances-of-a-certain-cohort-in-a-certain-window"></a>
</h4>
<p>If we wanted the number of appearances, we could instead use the <code>addCohortIntersectCount</code> function</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 2, 1, 3, 2, 1, 1, 2, 3, 2, 1</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 4, 1, 7, 2, 3, 5, 10, 6, 9, 8</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1961-04-27, 1997-02-08, 1956-03-09, 1980-07-04, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1970-08-24, 2011-04-10, 1956-12-19, 1989-02-23, 1…</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addCohortIntersectCount.html">addCohortIntersectCount</a></span><span class="op">(</span></span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"short_term"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span><span class="op">)</span>, <span class="st">"mid_term"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">31</span>, <span class="fl">180</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 2, 2, 1, 3, 2, 1, 1, 2, 3, 1</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 9, 4, 1, 7, 2, 3, 5, 10, 6, 8</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1922-08-27, 1961-04-27, 1997-02-08, 1956-03-09, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1928-06-22, 1970-08-24, 2011-04-10, 1956-12-19, 1…</span></span>
<span><span class="co">#&gt; $ cohort_1_mid_term    &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0</span></span>
<span><span class="co">#&gt; $ cohort_1_short_term  &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-a-column-with-the-firstlast-event-in-a-certain-window">Add a column with the first/last event in a certain window<a class="anchor" aria-label="anchor" href="#add-a-column-with-the-firstlast-event-in-a-certain-window"></a>
</h4>
<p>Say we wanted the date at which an individual was in another cohort then we can use the <code>addCohortIntersectDate</code> function. As there might be multiple records for the other cohort, we can also choose the first or the last appearance in that cohort.</p>
<p>First occurrence:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 3, 3, 2, 1, 1, 1, 3, 1, 3, 2</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 9, 4, 6, 8, 1, 5, 10, 7, 2, 3</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1972-05-17, 1936-05-20, 1954-03-09, 1935-10-23, 2…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1988-05-11, 1945-08-14, 1966-11-09, 1937-04-23, 2…</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addCohortIntersectDate.html">addCohortIntersectDate</a></span><span class="op">(</span></span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    order <span class="op">=</span> <span class="st">"first"</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 3, 2, 1, 2, 3, 1, 1, 3, 1, 3</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 9, 6, 8, 3, 4, 1, 5, 10, 7, 2</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1972-05-17, 1954-03-09, 1935-10-23, 1938-12-02, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1988-05-11, 1966-11-09, 1937-04-23, 1941-11-19, 1…</span></span>
<span><span class="co">#&gt; $ cohort_1_minf_to_inf &lt;date&gt; 1980-05-05, 1967-03-31, 1916-11-14, 1919-01-09, …</span></span></code></pre></div>
<p>Last occurrence:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 2, 3, 3, 2, 3, 2, 2, 1, 2, 3</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 4, 10, 7, 1, 2, 9, 6, 3, 8, 5</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1921-12-06, 1989-08-06, 1992-06-11, 1981-10-14, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1928-08-03, 1995-01-24, 1997-09-11, 1982-11-12, 1…</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addCohortIntersectDate.html">addCohortIntersectDate</a></span><span class="op">(</span></span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    order <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 2, 2, 1, 2, 3, 3, 2, 3, 2, 3</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 9, 6, 3, 4, 10, 7, 1, 2, 8, 5</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1969-11-14, 1938-04-30, 1983-05-27, 1921-12-06, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1973-09-22, 1939-02-01, 1993-11-26, 1928-08-03, 1…</span></span>
<span><span class="co">#&gt; $ cohort_1_minf_to_inf &lt;date&gt; 1971-02-23, 1942-11-21, 1971-04-30, NA, NA, NA, …</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="add-the-number-of-days-instead-of-the-date">Add the number of days instead of the date<a class="anchor" aria-label="anchor" href="#add-the-number-of-days-instead-of-the-date"></a>
</h4>
<p>Instead of returning a date, we could return the days to the intersection by using <code>addCohortIntersectDays</code></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 3, 2, 2, 1, 1, 3, 1, 1, 2, 1</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 1, 9, 5, 7, 4, 3, 2, 10, 6, 8</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1966-12-06, 1955-09-03, 1963-11-24, 1995-11-30, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1990-01-06, 1977-12-24, 1978-05-27, 1996-07-27, 2…</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addCohortIntersectDays.html">addCohortIntersectDays</a></span><span class="op">(</span></span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    order <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 2, 1, 1, 3, 2, 1, 1, 3, 1, 2</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 5, 2, 8, 1, 9, 7, 4, 3, 10, 6</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1963-11-24, 1913-08-23, 1982-09-08, 1966-12-06, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1978-05-27, 1914-08-12, 1991-06-28, 1990-01-06, 1…</span></span>
<span><span class="co">#&gt; $ cohort_1_minf_to_inf &lt;dbl&gt; 8809, 4412, -2029, NA, NA, NA, NA, NA, NA, NA</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="combine-multiple-cohort-intersects">Combine multiple cohort intersects<a class="anchor" aria-label="anchor" href="#combine-multiple-cohort-intersects"></a>
</h4>
<p>If we want to combine multiple cohort intersects we can concatenate the operations using the <code>pipe</code> operator:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 2, 1, 2, 3, 2, 3, 3, 2, 2, 3</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 2, 4, 3, 7, 10, 1, 6, 8, 9, 5</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1945-02-11, 1955-06-28, 1957-11-19, 1986-03-17, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1980-06-10, 1962-08-23, 1958-05-22, 1992-08-12, 1…</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addCohortIntersectDate.html">addCohortIntersectDate</a></span><span class="op">(</span></span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    order <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/addCohortIntersectCount.html">addCohortIntersectCount</a></span><span class="op">(</span></span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.1.1 [martics@Windows 10 x64:R 4.2.1/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;int&gt; 2, 3, 2, 1, 2, 3, 2, 3, 3, 2</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;int&gt; 8, 5, 2, 4, 3, 7, 10, 1, 6, 9</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 1972-02-17, 1944-11-17, 1945-02-11, 1955-06-28, 1…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 1987-10-18, 1947-12-20, 1980-06-10, 1962-08-23, 1…</span></span>
<span><span class="co">#&gt; $ cohort_1_minf_to_inf &lt;dbl&gt; 1, 1, 0, 0, 0, 0, 0, 0, 0, 0</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/mockDisconnect.html">mockDisconnect</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=PatientProfiles" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/darwin-eu/PatientProfiles/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/darwin-eu/PatientProfiles/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing PatientProfiles</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Marti Catala <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-3308-9905" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Yuchen Guo <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-0847-4855" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Mike Du <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-9517-8834" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Kim Lopez-Guell <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-8462-8668" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Edward Burn <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-9286-1128" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Nuria Mercade-Besora <br><small class="roles"> Author </small> <a href="https://orcid.org/0009-0006-7948-3747" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marti Catala, Yuchen Guo, Mike Du, Kim Lopez-Guell, Edward Burn, Nuria Mercade-Besora.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
